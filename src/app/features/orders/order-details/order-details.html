<section class="container-app py-10">
  <!-- Header -->
  <header class="mb-6 sm:mb-8 flex items-start justify-between gap-4">
    <div>
      <a routerLink="/orders" class="nav-link inline-flex items-center gap-2">
        <span aria-hidden="true">‹</span>
        Back to orders
      </a>

      <h1 class="mt-3 text-3xl sm:text-4xl font-extrabold tracking-tight">@if (isStaff()) { Order Details } @else { Ticket Details }</h1>
      <p class="mt-2 text-sm sm:text-base" style="color: rgb(var(--muted))">
        Review items, status, and order history.
      </p>
    </div>
  </header>

  @if (loading()) {
  <section class="card p-6">
    <p style="color: rgb(var(--muted))">Loading order…</p>
  </section>
  } @else if (!order()) {
  <section class="card p-6">
    <p class="text-sm" style="color: rgb(var(--muted))">Order not found.</p>
  </section>
  } @else {

  <!-- Summary -->
  <section class="card p-5 sm:p-6">
    <app-order-summary 
      [order]="order()!" 
      [isStaff]="isStaff()" 
    />

    @if (isStaff()) {
      <app-order-status-actions
        [canChangeStatus]="canChangeStatus()"
        [canCancel]="canCancel()"
        [selectedStatus]="selectedStatus()"
        [statusOptions]="statusOptions"
        [savingStatus]="savingStatus()"
        [cancelling]="cancelling()"
        (selectedStatusChange)="selectedStatus.set($event)"
        (save)="saveStatus()"
        (cancelConfirm)="cancelOrder()"
      />
    }
  </section>

  <!-- Items -->

  <app-order-items-editor
    [items]="editableItems()"
    [canEdit]="canEditItems()"
    [savingItems]="savingItems()"
    [availableEvents]="availableEvents()"
    [eventsLoading]="eventsLoading()"
    (increase)="increaseItem($event)"
    (decrease)="decreaseItem($event)"
    (quantityChange)="onQuantityInput($event.index, $event.quantity)"
    (remove)="removeItem($event)"
    (addItem)="addItem($event)"
    (saveItems)="saveItems()"
  />

  <!-- History -->

  <app-order-history
    [history]="history()"
    [loading]="historyLoading()"
  />

  }
</section>
